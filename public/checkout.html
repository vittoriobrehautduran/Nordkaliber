<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kassa - Nordkaliber</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'lavender-grey': '#D1CFE0',
                        'forest-teal': '#1B4332',
                        'deep-blue': '#0F172A',
                        'mustard-gold': '#E6B17A',
                        'muted-beige': '#F0E6D3',
                        'sage-green': '#6B8E6B',
                        'hunter-brown': '#A0522D',
                        'dark-green': '#1B4D3E',
                        'light-green': '#2D5A46',
                        'premium-black': '#0A0A0A',
                        'light-grey': '#E5E7EB',
                        'warm-grey': '#D1D5DB',
                        'cool-grey': '#9CA3AF',
                        'soft-grey': '#F3F4F6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: #32325d;
            overflow-x: hidden;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <a href="/design" class="flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors">
                    <i class="fas fa-arrow-left text-xl"></i>
                    <span class="text-xl font-semibold">NORDKALIBER</span>
                </a>
                <div class="text-right">
                    <div class="text-lg font-semibold text-gray-900">Betalning</div>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Order Summary -->
            <div class="lg:col-span-1">
                <div class="bg-white border border-gray-200 rounded-lg p-6 sticky top-8 shadow-sm">
                    <h2 class="text-xl font-semibold mb-4 text-gray-900">Orderöversikt</h2>
                    
                    <div id="orderItems" class="space-y-3 mb-6">
                        <!-- Order items will be populated here -->
                    </div>
                    
                    <div class="border-t border-gray-200 pt-4 space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Delsumma:</span>
                            <span id="subtotal" class="text-gray-900">0 kr</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Frakt:</span>
                            <span class="text-green-600">Gratis</span>
                        </div>
                        <div class="flex justify-between text-lg font-semibold text-gray-900">
                            <span>Totalt:</span>
                            <span id="total">0 kr</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Checkout Form -->
            <div class="lg:col-span-2">
                <div class="bg-white border border-gray-200 rounded-lg p-6 fade-in shadow-sm">
                    <h1 class="text-2xl font-bold mb-6 text-gray-900">Betalningsinformation</h1>
                    
                    <!-- Customer Information -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4 text-gray-900">Kundinformation</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="firstName" class="block text-sm font-medium mb-2 text-gray-700">Förnamn *</label>
                                <input type="text" id="firstName" required class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="lastName" class="block text-sm font-medium mb-2 text-gray-700">Efternamn *</label>
                                <input type="text" id="lastName" required class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="email" class="block text-sm font-medium mb-2 text-gray-700">E-postadress *</label>
                                <input type="email" id="email" required class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="phone" class="block text-sm font-medium mb-2 text-gray-700">Telefonnummer</label>
                                <input type="tel" id="phone" class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Shipping Address -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4 text-gray-900">Leveransadress</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="md:col-span-2">
                                <label for="address" class="block text-sm font-medium mb-2 text-gray-700">Gatuadress *</label>
                                <input type="text" id="address" required class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="postalCode" class="block text-sm font-medium mb-2 text-gray-700">Postnummer *</label>
                                <input type="text" id="postalCode" required class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="city" class="block text-sm font-medium mb-2 text-gray-700">Stad *</label>
                                <input type="text" id="city" required class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="country" class="block text-sm font-medium mb-2 text-gray-700">Land *</label>
                                <select id="country" required class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Välj land</option>
                                    <option value="SE">Sverige</option>
                                    <option value="NO">Norge</option>
                                    <option value="DK">Danmark</option>
                                    <option value="FI">Finland</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4 text-gray-900">Betalningsmetod</h3>
                        
                        <div class="bg-white border border-gray-300 rounded-lg p-4">
                            <div class="text-center">
                                <i class="fas fa-credit-card text-2xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600">Betalning hanteras säkert av Stripe</p>
                                <p class="text-sm text-gray-500 mt-1">Stödjer kort, PayPal, Klarna, Swish och Apple Pay</p>
                            </div>
                        </div>
                    </div>

                    <!-- Terms and Conditions -->
                    <div class="mb-8">
                        <div class="flex items-start space-x-3">
                            <input type="checkbox" id="terms" required class="mt-1">
                            <label for="terms" class="text-sm text-gray-700">
                                Jag accepterar <a href="#" class="text-blue-600 hover:underline">användarvillkoren</a> och <a href="#" class="text-blue-600 hover:underline">integritetspolicyn</a> *
                            </label>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button id="submit" class="w-full bg-blue-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors">
                        <div class="spinner hidden" id="spinner"></div>
                        <span id="button-text">Slutför köp</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let orderData = null;

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeCheckout();
        });

        // Initialize checkout
        function initializeCheckout() {
            // Load order data from localStorage
            loadOrderData();
            
            // Update order summary
            updateOrderSummary();
        }

        // Load order data from localStorage
        function loadOrderData() {
            const cartData = localStorage.getItem('nordkaliberCart');
            if (cartData) {
                orderData = JSON.parse(cartData);
            } else {
                // Create demo data if no cart data exists
                orderData = {
                    items: [
                        {
                            caliber: '6.5x55 Swedish Mauser',
                            primaryColor: 'green',
                            secondaryColor: 'black',
                            initials: '',
                            price: 850
                        }
                    ],
                    total: 850
                };
                console.log('Using demo order data');
            }
        }

        // Handle form submission
        document.getElementById('submit').addEventListener('click', handleSubmit);

        async function handleSubmit(e) {
            e.preventDefault();

            if (!validateForm()) {
                return;
            }

            setLoading(true);

            try {
                // For now, simulate a successful payment
                // In a real implementation, you would integrate with Stripe here
                console.log('Processing payment...');
                
                // Simulate payment processing
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Store order details for success page
                const orderDetails = {
                    items: orderData.items,
                    customer: {
                        firstName: document.getElementById('firstName').value,
                        lastName: document.getElementById('lastName').value,
                        email: document.getElementById('email').value,
                        phone: document.getElementById('phone').value,
                        address: document.getElementById('address').value,
                        postalCode: document.getElementById('postalCode').value,
                        city: document.getElementById('city').value,
                        country: document.getElementById('country').value
                    },
                    total: orderData.total,
                    orderId: 'ORD-' + Date.now()
                };
                
                localStorage.setItem('orderDetails', JSON.stringify(orderDetails));
                
                // Redirect to success page
                window.location.href = '/success';
                
            } catch (error) {
                console.error('Payment error:', error);
                showMessage('Ett fel uppstod vid betalning. Försök igen.', 'error');
            } finally {
                setLoading(false);
            }
        }

        // Validate form
        function validateForm() {
            const requiredFields = ['firstName', 'lastName', 'email', 'address', 'postalCode', 'city', 'country'];
            const terms = document.getElementById('terms');
            
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    showMessage(`Vänligen fyll i ${field.previousElementSibling.textContent.replace(' *', '')}`, 'error');
                    field.focus();
                    return false;
                }
            }
            
            if (!terms.checked) {
                showMessage('Du måste acceptera användarvillkoren', 'error');
                return false;
            }
            
            return true;
        }

        // Show/hide loading state
        function setLoading(isLoading) {
            if (isLoading) {
                document.querySelector('#submit').disabled = true;
                document.querySelector('#spinner').classList.remove('hidden');
                document.querySelector('#button-text').classList.add('hidden');
            } else {
                document.querySelector('#submit').disabled = false;
                document.querySelector('#spinner').classList.add('hidden');
                document.querySelector('#button-text').classList.remove('hidden');
            }
        }

        // Show message
        function showMessage(messageText, messageType) {
            // Create a temporary message element
            const messageElement = document.createElement('div');
            messageElement.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                messageType === 'error' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'
            }`;
            messageElement.textContent = messageText;
            
            document.body.appendChild(messageElement);
            
            setTimeout(() => {
                messageElement.remove();
            }, 4000);
        }

        // Update order summary
        function updateOrderSummary() {
            if (!orderData) return;

            const orderItemsContainer = document.getElementById('orderItems');
            const subtotalElement = document.getElementById('subtotal');
            const totalElement = document.getElementById('total');

            // Clear existing items
            orderItemsContainer.innerHTML = '';

            // Add items
            orderData.items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'flex justify-between items-center';
                itemElement.innerHTML = `
                    <div>
                        <div class="font-medium text-gray-900">${item.caliber}</div>
                        <div class="text-sm text-gray-600">${item.primaryColor}/${item.secondaryColor}</div>
                        ${item.initials ? `<div class="text-sm text-gray-600">Initialer: ${item.initials}</div>` : ''}
                    </div>
                    <div class="font-semibold text-gray-900">${item.price} kr</div>
                `;
                orderItemsContainer.appendChild(itemElement);
            });

            // Update totals
            const subtotal = orderData.items.reduce((sum, item) => sum + item.price, 0);
            subtotalElement.textContent = subtotal + ' kr';
            totalElement.textContent = subtotal + ' kr';
        }
    </script>
</body>
</html> 